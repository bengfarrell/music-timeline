{"version":3,"file":"timeline-view.js","sourceRoot":"","sources":["timeline-view.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,KAAK,CAAC;AACvC,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC5D,OAAO,EAAE,KAAK,EAAE,MAAM,qBAAqB,CAAC;AAE5C,OAAO,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAC;AAEvC,MAAM,OAAO,aAAc,SAAQ,KAAK;IASpC,YAAY,IAAY,EAAE,IAAkE,EAAE,aAAyB;QACnH,KAAK,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QAC3B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;QACtB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;IAC5B,CAAC;;AAZM,wBAAU,GAAG,WAAW,CAAC;AACzB,kBAAI,GAAG,MAAM,CAAC;AACd,0BAAY,GAAG,aAAa,CAAC;AAcjC,IAAM,YAAY,GAAlB,MAAM,YAAa,SAAQ,UAAU;IAsCxC,IAAI,QAAQ,CAAC,IAAiB;QAC1B,IAAI,CAAC,cAAc,GAAG,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QAC7C,IAAI,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,aAAa,CAAC,YAAY,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QACpI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;QACxF,IAAI,CAAC,aAAa,EAAE,CAAC;IACzB,CAAC;IACD;QACI,KAAK,EAAE,CAAC;QAxCZ,kBAAa,GAAW,CAAC,CAAC;QAG1B,gBAAW,GAAW,CAAC,CAAC;QAGxB,oBAAe,GAAW,CAAC,CAAC;QAG5B,aAAQ,GAAW,CAAC,CAAC;QAGrB,YAAO,GAAG,CAAC,CAAC;QAGZ,YAAO,GAAG,CAAC,CAAC;QAGZ,eAAU,GAAG,CAAC,CAAC;QAEL,aAAQ,GAAG,CAAC,CAAC;QAIvB,WAAM,GAAgB,EAAE,CAAC;QAIzB,gBAAW,GAAY,KAAK,CAAC;QAE7B,mBAAc,GAA6C,CAAE,SAAS,EAAE,SAAS,CAAE,CAAC;QAWhF,IAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACpE,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,GAAG,EAAE;YAC7C,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAE,GAAG,CAAE,CAAC,CAAC;YAC1D,IAAI,IAAI,CAAC,WAAW,IAAI,KAAK,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACzE,IAAI,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,aAAa,CAAC,YAAY,EAAE,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,CAAE,EAAE,KAAK,EAAE,KAAyB,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;aAC/J;iBAAM,IAAI,IAAI,CAAC,WAAW,EAAC;gBACxB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;gBACpC,IAAI,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,aAAa,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;gBACzH,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;aAChC;YACD,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;QACpC,CAAC,CAAC,CAAC;IACP,CAAC;IAES,aAAa,CAAC,CAAe;QACnC,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC;QAChC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC3C,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC;QACjE,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC;QAChD,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QAExB,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,SAAS,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;YAC9E,IAAI,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,aAAa,CAAC,YAAY,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;SACvI;QACD,IAAI,CAAC,cAAc,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QACxC,IAAI,CAAC,aAAa,EAAE,CAAC;IACzB,CAAC;IAES,aAAa,CAAC,CAAe;QACnC,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC;QACjE,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,QAAQ,IAAI,CAAC,cAAc,EAAE;gBACzB,KAAK,OAAO;oBACR,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC;oBAC5D,MAAM;gBACV,KAAK,KAAK;oBACN,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC;oBAC5D,MAAM;gBACV,KAAK,UAAU;oBACX,IAAI,CAAC,WAAW,GAAG,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;oBAC1C,MAAM;aACb;YACD,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,OAAO;SACV;QACD,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,EAAE;YAC1G,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC;YAC5D,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;YAC7B,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;IACL,CAAC;IAES,gBAAgB,CAAC,CAAe;QACtC,QAAS,CAAC,CAAC,MAAsB,CAAC,EAAE,EAAE;YAClC,KAAK,aAAa;gBACd,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAE,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC;gBAC1F,MAAM;YACV,KAAK,WAAW;gBACZ,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAE,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC;gBAC1F,MAAM;YACV,KAAK,UAAU;gBACX,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC;gBACjC,MAAM;SACb;QACD,CAAC,CAAC,cAAc,EAAE,CAAC;QACnB,CAAC,CAAC,eAAe,EAAE,CAAC;IACxB,CAAC;IAES,MAAM;QACZ,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAE,GAAG,CAAE,CAAC,CAAC;QAClE,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,SAAS,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,SAAS,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC;QAC5F,OAAO,IAAI,CAAA;mBACA,IAAI,CAAC,cAAc,EAAE;;gCAER,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAE,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,GAAG;iCAChD,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAE,GAAG,KAAK,CAAC,CAAC,CAAE,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,GAAG;;cAElF,IAAI,CAAC,UAAU,EAAE;gCACC,CAAC,CAAe,EAAE,EAAE;YACpC,MAAM,IAAI,GAAG,MAAM,CAAE,CAAC,CAAC,MAAyB,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YACpE,IAAI,IAAI,KAAK,SAAS,EAAE;gBACpB,IAAI,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,aAAa,CAAC,UAAU,EAC7D,EAAE,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;aAClG;QACL,CAAC;kBACK,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,KAAgB,EAAE,KAAK,EAAE,EAAE;YAC1C,OAAO,IAAI,CAAA,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,CAAC,EAAE,CAAC;QAClD,CAAC,CAAC;;cAEJ,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA,wCAAwC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa;sEAClD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,GAAG,CAAC;gEAChG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAE,GAAG,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG;8DACxG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAE,GAAG,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;IAC3L,CAAC;IAES,UAAU,CAAC,IAAe,EAAE,KAAa;QAC/C,OAAO,IAAI,CAAA,2CAA2C,KAAK;oCAC/B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,aAAa;4BACtC,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAK,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,GAAG,CAAC;+BAC9F,IAAI,CAAC,UAAU,GAAE,CAAC;8BACnB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,aAAa,CAAC;IAC1E,CAAC;IAES,cAAc;QACpB,MAAM,IAAI,GAAG,EAAE,CAAC;QAChB,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC,EAAE,EAAE;YAC9C,IAAI,CAAC,IAAI,CAAC,IAAI,CAAA,kCAAkC,CAAC;yBACpC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa;0BACtD,IAAI,CAAC,UAAU;uBAClB,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,YAAY,CAAC,CAAC;SACtF;QACD,OAAO,IAAI,CAAC;IAChB,CAAC;IAES,UAAU;QAChB,MAAM,KAAK,GAAG,EAAE,CAAC;QAEjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YACnD,MAAM,IAAI,GAAG,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC;YACpC,MAAM,UAAU,GAAG,CAAC,GAAG,IAAI,CAAC,eAAe,KAAK,CAAC,CAAC;YAClD,IAAI,UAAU,EAAE;gBACZ,KAAK,CAAC,IAAI,CAAC,IAAI,CAAA;yDAC0B,IAAI,YAAY,CAAC,CAAC;aAC9D;iBAAM;gBACH,KAAK,CAAC,IAAI,CAAC,IAAI,CAAA;yDAC0B,IAAI,YAAY,CAAC,CAAC;aAC9D;SACJ;QACD,OAAO,KAAK,CAAC;IACjB,CAAC;;AAlLM,mBAAM,GAAG,KAAK,AAAR,CAAS;AAEf,sBAAS,GAAG,EAAE,AAAL,CAAM;AAGtB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;mDACD;AAG1B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;iDACH;AAGxB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;qDACC;AAG5B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;8CACN;AAGrB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;6CACf;AAGZ;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;6CACf;AAGZ;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;gDACZ;AAxBN,YAAY;IADxB,aAAa,CAAC,kBAAkB,CAAC;GACrB,YAAY,CAoLxB","sourcesContent":["import { LitElement, html } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { style } from './timeline-view.css';\nimport { NoteEvent } from '../utils';\nimport { Timeline } from '../timeline';\n\nexport class TimelineEvent extends Event {\n    static NOTE_HOVER = 'notehover';\n    static SEEK = 'seek';\n    static RANGE_SELECT = 'rangeselect';\n\n    public time: number;\n    public note?: NoteEvent;\n    public range?: [number, number];\n\n    constructor(type: string, args: { time: number, note?: NoteEvent, range?: [number, number] }, eventInitDict?: EventInit) {\n        super(type, eventInitDict);\n        this.time = args.time;\n        this.range = args.range;\n    }\n}\n\n@customElement('ms-timeline-view')\nexport class TimelineView extends LitElement {\n    static styles = style;\n\n    static topGutter = 25;\n\n    @property({ type: Number })\n    pixelsPerBeat: number = 0;\n\n    @property({ type: Number })\n    currentTime: number = 0;\n\n    @property({ type: Number })\n    beatsPerMeasure: number = 0;\n\n    @property({ type: Number })\n    numBeats: number = 0;\n\n    @property({ type: Number })\n    noteMin = 0;\n\n    @property({ type: Number })\n    noteMax = 0;\n\n    @property({ type: Number })\n    noteHeight = 0;\n\n    protected duration = 0;\n\n    protected markerDragging?: 'start' | 'end' | 'playback';\n\n    _notes: NoteEvent[] = [];\n\n    bounds?: DOMRect;\n\n    isSelecting: boolean = false;\n    pendingSeek?: number;\n    selectionRange: [number | undefined, number | undefined] = [ undefined, undefined ];\n\n    set sequence(data: NoteEvent[]) {\n        this.selectionRange = [undefined, undefined];\n        this.dispatchEvent(new TimelineEvent(TimelineEvent.RANGE_SELECT, { time: 0, range: undefined }, { bubbles: true, composed: true }));\n        this._notes = data;\n        this.duration = data.reduce((max, note) => Math.max(max, note.time + note.duration), 0);\n        this.requestUpdate();\n    }\n    constructor() {\n        super();\n        this.addEventListener('pointerdown', this.onPointerDown.bind(this));\n        this.addEventListener('pointermove', this.onPointerMove.bind(this));\n        document.body.addEventListener('pointerup', () => {\n            const range = this.selectionRange.sort((a, b) => a! - b!);\n            if (this.isSelecting && range && range[0] !== range[1] && !this.pendingSeek) {\n                this.dispatchEvent(new TimelineEvent(TimelineEvent.RANGE_SELECT, { time: range[0]!, range: range as [number, number] }, { bubbles: true, composed: true }));\n            } else if (this.pendingSeek){\n                this.currentTime = this.pendingSeek;\n                this.dispatchEvent(new TimelineEvent(TimelineEvent.SEEK, { time: this.pendingSeek }, { bubbles: true, composed: true }));\n                this.pendingSeek = undefined;\n            }\n            this.isSelecting = false;\n            this.markerDragging = undefined;\n        });\n    }\n\n    protected onPointerDown(e: PointerEvent) {\n        this.markerDragging = undefined;\n        this.isSelecting = true;\n        this.bounds = this.getBoundingClientRect();\n        const x = e.clientX - (this.bounds?.left || 0) + this.scrollLeft;\n        const beat = Math.floor(x / this.pixelsPerBeat);\n        this.pendingSeek = beat;\n\n        if (this.selectionRange[0] !== undefined && this.selectionRange[1] !== undefined) {\n            this.dispatchEvent(new TimelineEvent(TimelineEvent.RANGE_SELECT, { time: 0, range: undefined }, { bubbles: true, composed: true }));\n        }\n        this.selectionRange = [beat, undefined];\n        this.requestUpdate();\n    }\n\n    protected onPointerMove(e: PointerEvent) {\n        const x = e.clientX - (this.bounds?.left || 0) + this.scrollLeft;\n        if (this.markerDragging) {\n            switch (this.markerDragging) {\n                case 'start':\n                    this.selectionRange[0] = Math.floor(x / this.pixelsPerBeat);\n                    break;\n                case 'end':\n                    this.selectionRange[1] = Math.floor(x / this.pixelsPerBeat);\n                    break;\n                case 'playback':\n                    this.pendingSeek = x / this.pixelsPerBeat;\n                    break;\n            }\n            this.requestUpdate();\n            return;\n        }\n        if (this.isSelecting && this.selectionRange && this.selectionRange[0] !== Math.floor(x / this.pixelsPerBeat)) {\n            this.selectionRange[1] = Math.floor(x / this.pixelsPerBeat);\n            this.pendingSeek = undefined;\n            this.requestUpdate();\n        }\n    }\n\n    protected handleMarkerDown(e: PointerEvent) {\n        switch ((e.target as HTMLElement).id) {\n            case 'start-range':\n                this.markerDragging = this.selectionRange[1]! > this.selectionRange[0]! ? 'start' : 'end';\n                break;\n            case 'end-range':\n                this.markerDragging = this.selectionRange[1]! > this.selectionRange[0]! ? 'end' : 'start';\n                break;\n            case 'playback':\n                this.markerDragging = 'playback';\n                break;\n        }\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    protected render() {\n        const range = this.selectionRange.slice().sort((a, b) => a! - b!);\n        const drawRange = range[0] !== undefined && range[1] !== undefined && range[0] !== range[1];\n        return html`\n            <div>${this.renderNoteRows()}</div>\n            <div id=\"selection-box\" \n                 style=\"left: ${drawRange ? range[0]! * this.pixelsPerBeat : -100}px;\n                        width: ${drawRange ? (range[1]! - range[0]!) * this.pixelsPerBeat : -100}px\"\n            ></div>\n            ${this.renderGrid()}\n            <div @pointermove=${(e: PointerEvent) => {\n                const note = Number((e.target as HTMLDivElement).dataset.noteIndex);\n                if (note !== undefined) {\n                    this.dispatchEvent(new TimelineEvent(TimelineEvent.NOTE_HOVER, \n                    { time: this._notes[note].time, note: this._notes[note] }, { bubbles: true, composed: true }));\n                }\n            }}>\n                ${this._notes.map((event: NoteEvent, index) => {\n                    return html`${this.renderNote(event, index)}`;\n                })}\n            </div>\n            ${this._notes.length > 0 ? html`<div id=\"playback-line\" style=\"left: ${this.currentTime * this.pixelsPerBeat}px\"></div>\n            <div class=\"marker playhead\" id=\"playback\" @pointerdown=${this.handleMarkerDown.bind(this)} style=\"left: ${this.currentTime * this.pixelsPerBeat - 3}px\"></div>\n            <div class=\"marker\" id=\"start-range\" @pointerdown=${this.handleMarkerDown.bind(this)} style=\"left: ${drawRange ? range[0]! * this.pixelsPerBeat - 3 : -100}px\"></div>\n            <div class=\"marker\" id=\"end-range\" @pointerdown=${this.handleMarkerDown.bind(this)} style=\"left: ${drawRange ? range[1]! * this.pixelsPerBeat - 3 : -100}px\"></div>` : undefined}`;\n    }\n\n    protected renderNote(note: NoteEvent, index: number) {\n        return html`<div class=\"noteblock\" data-note-index=\"${index}\"\n                     style=\"left: ${note.time * this.pixelsPerBeat}px;\n                     top: ${(this.noteMax - note.note! - 2) * this.noteHeight + 2 + this.noteHeight + Timeline.TOP_GUTTER - 1}px; \n                     height: ${this.noteHeight -3}px;\n                     width: ${note.duration * this.pixelsPerBeat}px;\"></div>`;\n    }\n\n    protected renderNoteRows() {\n        const rows = [];\n        for (let c = this.noteMin; c < this.noteMax; c++) {\n            rows.push(html`<div class=\"noterow\" data-note=${c} style=\"\n                width: ${this.duration * this.pixelsPerBeat + this.pixelsPerBeat}px;\n                height: ${this.noteHeight}px; \n                top: ${(c - this.noteMin) * this.noteHeight + Timeline.TOP_GUTTER}px\"></div>`);\n        }\n        return rows;\n    }\n\n    protected renderGrid() {\n        const ticks = [];\n\n        for (let c = 0; c < Math.ceil(this.numBeats) + 1; c++) {\n            const time = c * this.pixelsPerBeat;\n            const isHardTick = c % this.beatsPerMeasure === 0;\n            if (isHardTick) {\n                ticks.push(html`\n                    <div class=\"hardTick\" style=\"left: ${time}px\"></div>`);\n            } else {\n                ticks.push(html`\n                    <div class=\"softTick\" style=\"left: ${time}px\"></div>`);\n            }\n        }\n        return ticks;\n    }\n}"]}