<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <title>Audio Timeline</title>
    <script src="../timeline/index.js" type="module"></script>
    <script type="module">
        import { TimelineEvent } from '../timeline-view/index.js';
        import { Playback } from '../playback/audioplayback.js';

        let timer = null;
        Playback.loop();

        const timeline = document.querySelector('mt-audio');
        timeline.addEventListener(TimelineEvent.SEEK, (e) => {
            Playback.seek(e.time);
        });

        timeline.addEventListener('loaded', (e) => {
            Playback.data = timeline.buffer;
        });

        timeline.addEventListener(TimelineEvent.RANGE_SELECT, (e) => {
            if (e.range) {
                Playback.loop(...e.range);
            } else {
                Playback.cancelLoop();
            }
        });

        document.getElementById('play').addEventListener('click', async () => {
            Playback.play();
            if (timer) {
                clearInterval(timer);
            }
            setInterval(() => {
                timeline.currentTime = Playback.currentTime;
            }, 100);
        });

        document.getElementById('rate').addEventListener('change', (e) => {
            Playback.rate = e.target.value;
        });

        document.getElementById('pause').addEventListener('click', () => {
            Playback.pause();
        });

        //document.getElementById('timeline').midiTrack = generateExample();
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<button id="play">Play</button>
<button id="pause">Pause</button>
<label>Rate</label>
<input id="rate" type="number" min="0.1" value="1" max="5" step="0.1" />
<br/><br/>

<mt-audio waveformcolor="white" src="samples/startrek.mp3"></mt-audio>
</body>
</html>
